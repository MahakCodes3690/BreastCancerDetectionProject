<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Breast Cancer Detection — Demo</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
  <div class="container">
    <h2>Breast Cancer Detection — Demo</h2>
    <p>Paste a CSV of 30 features (order shown), or JSON with "feature_dict".</p>

    <h4>Feature order:</h4>
    <pre id="featList">{{features|join(', ')}}</pre>

    <h4>Paste CSV: v1,v2,...,v30</h4>
    <textarea id="csv" placeholder="Paste CSV: v1,v2,...,v30"></textarea>
    <div class="row">
      <button id="sampleBtn" class="btn btn--muted">Fill sample row</button>
      <button id="sendCsv" class="btn">Predict from CSV</button>
    </div>

    <hr style="margin:18px 0" />

    <h4>Or JSON (feature_dict)</h4>
    <textarea id="json" placeholder='{"feature_dict":{"radius_mean":17.99, ...}}'></textarea>
    <div class="row">
      <button id="sendJson" class="btn">Predict from JSON</button>
    </div>

    <h3 style="margin-top:18px">Result</h3>
    <div id="result"><em>No result yet</em></div>
    <div id="error" class="err"></div>
  </div>

<script>
const sample = "17.99,10.38,122.8,1001.0,0.1184,0.2776,0.3001,0.1471,0.2419,0.07871,1.095,0.9053,8.589,153.4,0.006399,0.04904,0.05373,0.01587,0.03003,0.006193,25.38,17.33,184.6,2019.0,0.1622,0.6656,0.7119,0.2654,0.4601,0.1189";

document.getElementById("sampleBtn").onclick = () => {
  document.getElementById("csv").value = sample;
};

function showResult(obj){
  document.getElementById("error").textContent = "";
  document.getElementById("result").textContent = JSON.stringify(obj, null, 2);
}

function showError(msg){
  document.getElementById("error").textContent = msg;
  document.getElementById("result").innerHTML = "<em>No result</em>";
}

document.getElementById("sendCsv").onclick = async () => {
  const csv = document.getElementById("csv").value.trim();
  if(!csv) { showError("Please paste CSV row first."); return; }
  const parts = csv.split(",").map(s=>s.trim()).filter(s=>s!=="");
  if(parts.length !== 30){ showError("CSV must contain exactly 30 numeric values. Found: "+parts.length); return; }
  try {
    const res = await fetch("/predict", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({csv})
    });
    const j = await res.json();
    if(res.ok) showResult(j); else showError(j.error || JSON.stringify(j));
  } catch(e){
    showError("Network error: "+e.message);
  }
};

document.getElementById("sendJson").onclick = async () => {
  let txt = document.getElementById("json").value.trim();
  if(!txt){ showError("Please add JSON payload first."); return; }
  try {
    const obj = JSON.parse(txt);
    const res = await fetch("/predict", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(obj)
    });
    const j = await res.json();
    if(res.ok) showResult(j); else showError(j.error || JSON.stringify(j));
  } catch(e){
    showError("Invalid JSON or network error: "+e.message);
  }
};
</script>
</body>
</html>
